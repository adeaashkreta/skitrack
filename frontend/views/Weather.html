<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ski Track – Resort Weather</title>
  <meta
    name="description"
    content="Live snow stats, slope status and 7-day forecasts for the world’s best ski resorts."
  />

  <!-- Core CSS  shared site palette -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    rel="stylesheet"
  />
  <link href="../css/style.css" rel="stylesheet" />

  <style>
    :root {
      --blue-accent: var(--accent);
      /* pulls from style.css */
      --light-bg: var(--background);
      /* site backdrop colour  */
      --wave-fill: #ecf2f8;
      /* slightly darker tint */
    }

    /* ------------- card shells ------------- */
    .section-card {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      padding: 1.7rem;
    }
    .info-card {
      background: #fefefe;
      border: 0;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
      transition: transform 0.25s;
      font-size: 0.95rem;
    }
    .info-card:hover,
    .forecast-card:hover {
      transform: scale(1.04);
    }

    /* progress bar */
    .progress {
      height: 6px;
      background: #e4edf6;
      border-radius: 4px;
    }
    .progress-bar {
      background: var(--blue-accent);
    }

    /* section headings */
    .section-heading {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      position: relative;
      padding-bottom: 0.4rem;
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }
    .section-heading::after {
      content: "";
      position: absolute;
      left: 50%;
      bottom: 0;
      width: 48px;
      height: 3px;
      background: var(--blue-accent);
      transform: translateX(-50%);
      border-radius: 4px;
    }

    /* layout spacing */
    .section-block {
      padding: 2rem 0;
    }
    .wave-divider {
      margin-top: -1rem;
      line-height: 0;
    }
    .wave-divider svg {
      width: 100%;
      height: 40px;
      display: block;
    }
    .wave-divider path {
      fill: var(--wave-fill);
    }
    .stats-grid {
      --bs-gutter-x: 0.8rem;
      --bs-gutter-y: 0.9rem;
    }

    /* fade-in */
    .reveal {
      opacity: 0;
      transform: translateY(20px);
      transition: 0.48s ease-out;
    }
    .reveal.show {
      opacity: 1;
      transform: none;
    }

    /* skeleton shimmer */
    .skeleton {
      background: linear-gradient(
        90deg,
        #f0f3f7 25%,
        #e1e6ee 37%,
        #f0f3f7 63%
      );
      background-size: 400% 100%;
      animation: skeleton 1.2s ease-in-out infinite;
    }
    @keyframes skeleton {
      0% {
        background-position: 100% 0;
      }
      100% {
        background-position: -100% 0;
      }
    }

    /* pill buttons (reuse site vars) */
    .btn-primary,
    .btn-accent {
      background: var(--blue-accent);
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 50px;
      padding: 0.65rem 1.4rem;
      transition: box-shadow 0.18s, background 0.18s;
    }
    .btn-primary:hover,
    .btn-accent:hover {
      background: var(--secondary);
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
    }
    .btn-outline-accent {
      border: 2px solid var(--blue-accent);
      color: var(--blue-accent);
      font-weight: 600;
      border-radius: 50px;
      padding: 0.6rem 1.4rem;
      transition: background 0.18s, color 0.18s;
    }
    .btn-outline-accent:hover {
      background: var(--blue-accent);
      color: #fff;
    }

    /* search focus ring */
    #resortInput:focus {
      border-color: var(--blue-accent) !important;
      box-shadow: 0 0 0 0.16rem rgba(98, 198, 238, 0.35) !important;
    }

    /* sticky CTA bar */
    #ctaBar {
      position: fixed;
      bottom: -100px;
      left: 0;
      width: 100%;
      background: var(--primary);
      color: #fff;
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      transition: bottom 0.4s ease;
      z-index: 1200;
      box-shadow: 0 -3px 12px rgba(0, 0, 0, 0.2);
    }
    #ctaBar.show {
      bottom: 0;
    }

    /* ——— HERO RE-SKIN ——— */
    .hero {
      min-height: 60vh;
    }
    /* a little taller for impact   */
    .hero-copy h1 {
      font-size: clamp(2.2rem, 4.3vw, 3.4rem);
      font-weight: 700;
    }
    .hero-copy p {
      font-size: 1.15rem;
      max-width: 46ch;
      margin-inline: auto;
    }
    .hero-cta .btn-accent {
      background: var(--accent);
      border-radius: 50px;
      font-weight: 600;
      padding: 0.68rem 1.6rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 15px;
    }
    .hero-cta .btn-accent:hover {
      background: var(--secondary);
    }
    .hero-cta .link-light {
      opacity: 0.8;
      text-decoration: none;
      margin-top: 25px;
    }
    .hero-cta .link-light:hover {
      opacity: 1;
      text-decoration: underline;
    }

    /* scroll cue */
    .scroll-arrow {
      position: absolute;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.25rem;
      color: #fff;
      opacity: 0.75;
      animation: bounce 2.4s infinite;
    }
    @keyframes bounce {
      0%,
      20%,
      50%,
      80%,
      100% {
        transform: translate(-50%, 0);
      }
      40% {
        transform: translate(-50%, -6px);
      }
      60% {
        transform: translate(-50%, -3px);
      }
    }

    /* tighten following section top-padding (hero is taller now) */
    .section-block:first-of-type {
      padding-top: 1.5rem;
    }

    #headerFlex {
      gap: 1.5rem;
    }
    #resortBlock h2 {
      font-size: 1.7rem;
    }
    #ratingRow {
      gap: 0.35rem;
    }
  </style>
</head>
<body>
  <!-- NAVBAR (same markup as index.html) -->
  <nav class="navbar navbar-expand-lg">
    <div class="container nav-flex">
      <div class="logo d-flex align-items-center">
        <a href="index.html">
          <img src="../images/logo.png" alt="Ski Track logo" width="54" height="54" />
        </a>
        <a
          href="index.html"
          class="ms-2 text-light fw-semibold text-decoration-none"
          >Ski Track</a
        >
      </div>
      <button
        class="navbar-toggler"
        data-bs-toggle="collapse"
        data-bs-target="#navMenu"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="nav-links navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Resorts.html">Resorts</a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="weather.html"
              >Weather</a
            >
          </li>
          <li class="nav-item"><a class="nav-link" href="#">About</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO — redesigned -->
  <header class="hero position-relative">
    <div class="hero-image-container">
      <img
        src="../images/MountainBackground.jpg"
        class="hero-img"
        alt="Fresh powder on alpine peaks"
        loading="lazy"
      />
      <div class="hero-gradient"></div>
    </div>

    <div
      class="container hero-content d-flex flex-column justify-content-center align-items-center text-white text-center"
    >
      <div class="hero-copy mb-3">
        <h1 class="mb-3">Know Before You Go</h1>
        <p>
          Real-time snow depth, slope status and 7-day forecasts for over 2 000
          resorts worldwide.
        </p>
      </div>

      <!-- search  secondary link -->
      <form
        id="searchForm"
        class="hero-cta d-flex flex-wrap gap-2 justify-content-center"
        onsubmit="return false"
      >
        <input
          id="resortInput"
          class="form-control form-control-lg"
          style="min-width: 240px"
          placeholder="Search resort (e.g. Zermatt)"
          required
        />
        <button id="searchBtn" class="btn btn-accent btn-lg">
          <i class="fas fa-search"></i>Search
        </button>
      </form>
    </div>

    <!-- subtle scroll hint -->
    <span class="scroll-arrow"><i class="fa-solid fa-angle-down"></i></span>
  </header>

  <div class="wave-divider">
    <svg viewBox="0 0 1440 40">
      <path
        d="M0,20L60,26C120,32,240,44,360,42C480,40,600,24,720,24C840,24,960,40,1080,40C1200,40,1320,24,1380,18L1440,12V40H0Z"
      ></path>
    </svg>
  </div>

  <!-- “No results” message (hidden by default) -->
  <div
    id="noResultMessage"
    class="text-center text-danger mt-4"
    style="display: none;"
  ></div>

  <!-- RESORT HEADER CARD -------------------------------------------------->
  <section
    id="resortHeader"
    class="section-block"
    style="display: none"
    aria-live="polite"
  >
    <div class="container">
      <div class="section-card py-3 px-4">
        <div
          id="headerFlex"
          class="d-flex flex-column flex-md-row justify-content-between align-items-center"
        >
          <!-- Resort name  rating block -->
          <div id="resortBlock" class="text-center flex-grow-1">
            <h2 id="resortName" class="fw-bold mb-1"></h2>
            <div
              id="ratingRow"
              class="d-flex justify-content-center align-items-center flex-wrap"
            >
              <div id="resortRating" class="fs-5"></div>
              <span id="recommendation" class="badge bg-success"></span>
            </div>
          </div>

          <!-- Book Now button -->
          <button class="btn btn-outline-accent mt-3 mt-md-0" id="bookBtn">
            <i class="fas fa-ticket-alt me-1"></i>Book&nbsp;Now
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- WAVE -->
  <div class="wave-divider">
    <svg viewBox="0 0 1440 40">
      <path
        d="M0,20L60,26C120,32,240,44,360,42C480,40,600,24,720,24C840,24,960,40,1080,40C1200,40,1320,24,1380,18L1440,12V40H0Z"
      ></path>
    </svg>
  </div>

  <!-- STATUS  WEATHER CARDS --------------------------------------------->
  <section
    id="statusSection"
    class="section-block bg-light"
    style="display: none"
  >
    <div class="container">
      <div class="row g-3">
        <!-- slope -->
        <div class="col-lg-6 reveal">
          <div class="section-card h-100">
            <div class="section-heading text-center">Slope &amp; Lifts</div>
            <div class="row stats-grid" id="slopeGrid">
              <div class="col-6">
                <div class="info-card p-3 text-center">
                  <i class="fas fa-mountain text-primary mb-1"></i
                  ><span id="slopeQuality" class="fw-semibold"></span>
                </div>
              </div>
              <div class="col-6">
                <div class="info-card p-3 text-center">
                  <i class="fas fa-skiing text-info mb-1"></i
                  ><span id="groomedStatus" class="fw-semibold"></span>
                  <div class="progress mt-1">
                    <div
                      id="groomedBar"
                      class="progress-bar"
                      role="progressbar"
                    ></div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="info-card p-3 text-center">
                  <i class="fas fa-route text-success mb-1"></i
                  ><span id="runsOpen" class="fw-semibold"></span>
                </div>
              </div>
              <div class="col-6">
                <div class="info-card p-3 text-center">
                  <i class="fas fa-chairlift text-warning mb-1"></i
                  ><span id="liftsOpen" class="fw-semibold"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- weather -->
        <div class="col-lg-6 reveal">
          <div class="section-card h-100">
            <div class="section-heading text-center">Weather &amp; Snow</div>
            <div class="row stats-grid" id="statsGrid">
              <div class="col-6 col-md-4">
                <div class="info-card p-3 text-center">
                  <span class="display-6">🌡</span
                  ><span id="currentTemp" class="fw-semibold ms-1"></span
                  ><small class="text-muted d-block">Current</small>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="info-card p-3 text-center">
                  <span class="display-6">❄️</span
                  ><span id="snow24h" class="fw-semibold ms-1"></span
                  ><small class="text-muted d-block">24 h</small>
                </div>
              </div>
              <div class="col-6 col-md-4">
                <div class="info-card p-3 text-center">
                  <span class="display-6">🗓</span
                  ><span id="snow3d" class="fw-semibold ms-1"></span
                  ><small class="text-muted d-block">3 d</small>
                </div>
              </div>
              <div class="col-6 col-md-6">
                <div class="info-card p-3 text-center">
                  <span class="display-6">📅</span
                  ><span id="snow7d" class="fw-semibold ms-1"></span
                  ><small class="text-muted d-block">7 d</small>
                </div>
              </div>
              <div class="col-6 col-md-6">
                <div class="info-card p-3 text-center">
                  <span class="display-6">☀️</span
                  ><span id="bluebirdDays" class="fw-semibold ms-1"></span
                  ><small class="text-muted d-block">Blue-bird</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- WAVE -->
  <div class="wave-divider">
    <svg viewBox="0 0 1440 40">
      <path
        d="M0,28L60,34C120,40,240,52,360,48C480,44,600,28,720,28C840,28,960,44,1080,44C1200,44,1320,28,1380,22L1440,18V40H0Z"
      ></path>
    </svg>
  </div>

  <!-- FORECAST CARD ------------------------------------------------------->
  <section id="forecastSection" class="section-block" style="display: none">
    <div class="container">
      <div class="section-card">
        <div class="section-heading text-center">7-Day Forecast</div>
        <div class="row stats-grid" id="forecastGrid"></div>
      </div>
    </div>
  </section>

  <!-- sticky CTA --------------------------------------------------------->
  <div id="ctaBar">
    <span class="me-2 fw-semibold">Ready for the slopes?</span
    ><a href="#" class="btn btn-primary btn-sm">Plan your trip</a>
  </div>

  <!-- FOOTER -->
  <footer class="footer bg-dark text-light py-3">
    <div
      class="container d-flex flex-column flex-md-row justify-content-between align-items-center"
    >
      <span>© <span id="year"></span> Ski Track</span>
      <div class="d-flex gap-3">
        <a href="#" class="text-light"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="text-light"><i class="fab fa-instagram"></i></a>
        <a href="#" class="text-light"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
  </footer>

  <!-- JS (updated to call your back end) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (() => {
      // Shortcut selectors
      const $  = (sel) => document.querySelector(sel);
      const $$ = (sel) => document.querySelectorAll(sel);

      // IntersectionObserver for “reveal” animations
      const revealObs = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) entry.target.classList.add("show");
          });
        },
        { threshold: 0.15 }
      );

      // Show or hide skeleton shimmer
      function toggleSkeleton(on) {
        $$(".info-card, .forecast-card").forEach((el) =>
          el.classList.toggle("skeleton", on)
        );
      }

      // Main render function: fetch from back end and populate UI
      async function render(resortKey) {
        if (!resortKey) {
          alert("Please enter a resort name.");
          return;
        }

        // Show skeletons & hide sections
        toggleSkeleton(true);
        $("#resortHeader").style.display   = "none";
        $("#statusSection").style.display   = "none";
        $("#forecastSection").style.display = "none";
           $("#noResultMessage").style.display = "none";
    try {
      // ───── REPLACED with OpenWeatherMap  Ski-Resort API calls ─────
      const OWM_API_KEY   = "1cb9a8c0a9f56d529da9bb8c58189a85";
      const RAPIDAPI_KEY  = "7c49c5f114msh6f50fa985406bb8p1039afjsnaa13a7cca12e";

      // Hard‐coded resort → lat/lon map
      const resortCoords = {
        Zermatt: { lat: 46.0207, lon: 7.7491 },
        Kosovo:  { lat: 43.0207, lon: 5.7491 },
        // … other resorts …
      };

      const coords = resortCoords[resortKey];
      if (!coords) {
        $("#noResultMessage").textContent =
          "Coordinates for `" + resortKey + "` not found. Please add them.";
        $("#noResultMessage").style.display = "block";
        toggleSkeleton(false);
        return;
      }

      // 4) Fetch weather + snow data from OpenWeatherMap One Call:
 const weatherUrl =
   `https://api.openweathermap.org/data/2.5/onecall?lat=${coords.lat}` +
   `&lon=${coords.lon}` +
   `&exclude=minutely,hourly,alerts` +
   `&units=metric` +
   `&appid=${OWM_API_KEY}`;

          // ─── DEBUG: print the full URL to DevTools console ───
            console.log("DEBUG: weatherUrl =", weatherUrl);
      const weatherRes = await fetch(weatherUrl);
      if (!weatherRes.ok) {
        $("#noResultMessage").textContent =
          "Could not fetch weather data. Check your OpenWeatherMap API key.";
        $("#noResultMessage").style.display = "block";
        toggleSkeleton(false);
        return;
      }
      const weatherJson = await weatherRes.json();

      // 5) Extract snow, temperature, bluebirdDays, etc.
      const currentTemp = Math.round(weatherJson.current.temp);
      const snow24h = weatherJson.daily[0].snow || 0;
      const snow3d =
        (weatherJson.daily[0].snow || 0) +
        (weatherJson.daily[1].snow || 0) +
        (weatherJson.daily[2].snow || 0);
      const snow7d = weatherJson.daily
        .slice(0, 7)
        .reduce((sum, d) => sum + (d.snow || 0), 0);
      const bluebirdDays = weatherJson.daily
        .slice(0, 7)
        .filter((d) => d.weather[0].main === "Clear")
        .length;

      // 6) Fetch slope & lift info from Ski Resort Conditions (RapidAPI)…
      const skiUrl =
        `https://ski-resort-conditions.p.rapidapi.com/conditions?resort=${encodeURIComponent(
          resortKey
        )}`;
      const skiRes = await fetch(skiUrl, {
        method: "GET",
        headers: {
          "X-RapidAPI-Key": RAPIDAPI_KEY,
          "X-RapidAPI-Host": "ski-resort-conditions.p.rapidapi.com",
        },
      });
      if (!skiRes.ok) {
        $("#noResultMessage").textContent =
          "Could not fetch ski-resort data. Check your RapidAPI key/host.";
        $("#noResultMessage").style.display = "block";
        toggleSkeleton(false);
        return;
      }
      const resortData = await skiRes.json();

      // 7) Build the single `data` object your UI expects…
      const data = {
        name: resortKey,
        rating: null,
        recommendation: null,
        slope: {
          runsOpen:       resortData.open_trails       || "N/A",
          liftsOpen:      resortData.open_lifts        || "N/A",
          quality:        resortData.slope_quality     || "Unknown",
          groomed:        resortData.percentage_groomed || 0,
          skiableTerrain: resortData.skiable_terrain   || "N/A",
        },
        weather: {
          currentTemp:  currentTemp,
          snow24h:      snow24h,
          snow3d:       snow3d,
          snow7d:       snow7d,
          bluebirdDays: bluebirdDays,
        },
        forecast: weatherJson.daily.slice(0, 7).map((d) => {
          const date = new Date(d.dt * 1000);
          const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
          return {
            day: days[date.getDay()],
            icon: `<img
                     src="https://openweathermap.org/img/wn/${d.weather[0].icon}@2x.png"
                     alt="${d.weather[0].main}"
                     style="width:1.5rem;height:1.5rem;"
                   >`,
            lo: Math.round(d.temp.min),
            hi: Math.round(d.temp.max),
          };
        }),
      };

      // Show all sections & do the reveal animations…
      $("#resortHeader").style.display   = "block";
      $("#statusSection").style.display  = "block";
      $("#forecastSection").style.display = "block";
      revealObs.disconnect();
      document.querySelectorAll(".reveal").forEach((el) =>
        el.classList.add("show")
      );
    } finally {
      toggleSkeleton(false);
    }
    }
    // ══════ EXISTING render END ══════

    // Search form handler & default load
    $("#searchForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const resortKey = $("#resortInput").value.trim();
      render(resortKey);
    });
    $("#year").textContent = new Date().getFullYear();
    render("Zermatt"); // default
  })();
  </script>
</body>
</html>

